commit 499484f56d336f4628a6fa016626beb3ef21ba81
Merge: 43c090e 37d974f
Author: bors <bors@rust-lang.org>
Date:   Thu Aug 18 08:54:10 2016 -0700

    Auto merge of #35684 - nikomatsakis:incr-comp-metadata-audit-35111, r=mw
    
    Restructure metadata encoder to track deps precisely
    
    This issue restructures meta-data encoding to track dependencies very precisely. It uses a cute technique I hope to spread elsewhere, where we can guard the data flowing into a new dep-graph task and ensure that it is not "leaking" information from the outside, which would result in missing edges. There are no tests because we don't know of any bugs in the old system, but it's clear that there was leaked data.
    
    The commit series is standalone, but the refactorings are kind of "windy". It's a good idea to read the comment in `src/librustc_metadata/index_builder.rs` to get a feeling for the overall strategy I was aiming at.
    
    In several cases, I wound up adding some extra hashtable lookups, I think primarily for looking up `AdtDef` instances. We could remove these by implementing `DepGraphRead` for an `AdtDef` and then having it register a read to the adt-defs table, I guess, but I doubt it is really noticeable.
    
    Eventually I think I'd like to extend this pattern to the dep-graph more generally, since it effectively guarantees that data cannot leak.
    
    Fixes #35111.
    
    r? @michaelwoerister
rustc: ./html5ever-2015-05-15
cargo rustc -- -Ztime-passes -Zinput-stats
    Updating registry `https://github.com/rust-lang/crates.io-index`
    Updating git repository `https://github.com/reem/rust-mac`
    Updating git repository `https://github.com/servo/string-cache`
   Compiling lazy_static v0.1.16
   Compiling rustc-serialize v0.3.19
   Compiling libc v0.2.15
   Compiling winapi-build v0.1.1
   Compiling num-traits v0.1.35
   Compiling phf_shared v0.7.16
   Compiling void v1.0.2
   Compiling winapi v0.2.8
   Compiling mac v0.0.2 (https://github.com/reem/rust-mac#6316d3f4)
   Compiling unreachable v0.1.1
   Compiling log v0.3.6
   Compiling debug_unreachable v0.0.6
   Compiling kernel32-sys v0.2.2
   Compiling phf v0.7.16
   Compiling time v0.1.35
   Compiling rand v0.3.14
   Compiling num-integer v0.1.32
   Compiling phf_generator v0.7.16
   Compiling phf_macros v0.7.16
   Compiling string_cache_shared v0.1.12
   Compiling num-iter v0.1.32
   Compiling num v0.1.35
   Compiling serde v0.6.15
   Compiling string_cache v0.1.17
   Compiling html5ever_macros v0.0.0 (file:///root/benchmarks/html5ever-2015-05-15)
Build failed, waiting for other jobs to finish...
makefile:2: recipe for target 'all' failed
done
